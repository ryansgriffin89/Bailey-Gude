<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bailey‚Äôs Guide to Wellness</title>

<link rel="manifest" href="./manifest.webmanifest" />
<meta name="theme-color" content="#0b0b12" />

<style>
:root{
  --bg0:#07070c;--bg1:#0b0b12;
  --pink:#ff3bd4;--cyan:#39f5ff;--lime:#a6ff4d;--violet:#8a5cff;--orange:#ff9f2e;
  --text:rgba(255,255,255,.92);--muted:rgba(255,255,255,.62);
  --radius:26px;--shadow:0 20px 60px rgba(0,0,0,.45);
  --font:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0;font-family:var(--font);color:var(--text);
  background:linear-gradient(180deg,var(--bg0),var(--bg1));
  padding-bottom:220px;
}
header{text-align:center;padding:34px 18px 16px}
h1{margin:0;font-size:1.85rem;font-weight:1000}
.subtitle{margin-top:8px;font-size:0.82rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.74);}
.container{max-width:640px;margin:auto;padding:0 14px}
.card{
  background:rgba(255,255,255,.06);
  border-radius:var(--radius);
  padding:22px;
  margin-bottom:18px;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.08);
}
.section-label{
  margin:34px 8px 14px;
  font-size:.78rem;
  letter-spacing:2px;
  text-transform:uppercase;
  color:rgba(255,255,255,.80);
  font-weight:900
}
button{font-family:inherit;cursor:pointer}
.btn{
  border:none;border-radius:999px;padding:14px 20px;font-weight:900;
  background:linear-gradient(90deg,var(--pink),var(--cyan));
  color:#07070c
}
.btn2{
  border:1px solid rgba(255,255,255,.14);
  border-radius:999px;
  padding:12px 16px;
  font-weight:900;
  background:rgba(255,255,255,.06);
  color:rgba(255,255,255,.90);
}
.btnLink{
  border:none;background:transparent;color:rgba(57,245,255,.95);
  font-weight:900;padding:0;cursor:pointer;
}
.confetti{position:fixed;width:10px;height:10px;animation:fall linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg)}}

input, textarea, select{
  width:100%;padding:10px;border-radius:14px;border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.92);
  font-size:.92rem;outline:none;margin-top:8px;
}
textarea{resize:vertical;height:90px}
hr{border:none;border-top:1px solid rgba(255,255,255,.10);margin:16px 0}

/* Chips / pills */
.pills{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.pill{
  padding:10px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  font-weight:900;font-size:.86rem;color:rgba(255,255,255,.86);
}

/* Accordion */
.acc{
  margin-top:12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  overflow:hidden;
  background:rgba(255,255,255,.05);
}
.acc summary{
  list-style:none;
  cursor:pointer;
  padding:12px 14px;
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  font-weight:1000;
}
.acc summary::-webkit-details-marker{display:none}
.acc .body{
  padding:0 14px 14px 14px;
  color:rgba(255,255,255,.78);
  line-height:1.55;
}
.badge{
  font-size:.78rem;font-weight:1000;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:rgba(255,255,255,.86);
  white-space:nowrap;
}

/* Bottom nav */
.nav{
  position:fixed;left:0;right:0;bottom:0;
  z-index:999;
  padding:12px 12px 18px;
  background:linear-gradient(180deg, rgba(7,7,12,.00), rgba(7,7,12,.75) 25%, rgba(7,7,12,.95));
  backdrop-filter: blur(10px);
}
.navRow{
  max-width:680px;margin:0 auto;
  display:grid;grid-template-columns:repeat(6,1fr);
  gap:10px;
}
.nav a{
  text-decoration:none;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:10px 8px;border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:rgba(255,255,255,.88);
  font-weight:1000;font-size:.75rem;
}
.nav a span{font-size:1.05rem;line-height:1;margin-bottom:6px}
.nav a:active{transform:scale(.98)}
.navHint{
  max-width:680px;margin:10px auto 0;
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  color:rgba(255,255,255,.70);font-weight:900;font-size:.82rem;
}

/* Floating confetti button (kept) */
.float{
  position:fixed;left:0;right:0;bottom:92px;
  display:flex;justify-content:center;
  z-index:1000;pointer-events:none;
}
.float button{pointer-events:auto}

/* Sub cards */
.subcard{
  margin-top:12px;padding:12px;border-radius:16px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10)
}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:520px){ .grid2{grid-template-columns:1fr} }

/* Tracker bubbles */
.lb{
  aspect-ratio:1;
  border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  font-weight:900;color:rgba(255,255,255,.70);
  cursor:pointer;
  user-select:none;
}

/* Compare images */
.compareWrap{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.compareWrap img{
  width:100%;height:260px;object-fit:cover;border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
}
@media (max-width:520px){ .compareWrap{grid-template-columns:1fr} .compareWrap img{height:220px} }
.smallNote{color:rgba(255,255,255,.72);font-weight:800;font-size:.86rem}
</style>
</head>

<body id="top">

<header>
  <h1>Bailey‚Äôs Guide to Wellness</h1>
  <div class="subtitle" id="dailyHeader"></div>
</header>

<div class="container">

  <!-- START HERE -->
  <div class="card" id="today">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap">
      <div>
        <strong>Goal:</strong> 166 ‚Üí 140<br>
        <strong>Plan:</strong> 4√ó/week ¬∑ 30 minutes<br>
        <strong>Non-negotiables:</strong> Protein ¬∑ Steps ¬∑ Sleep<br><br>
        <em>If you do only ONE thing today:</em><br>
        <strong id="oneThing"></strong>
      </div>

      <div style="min-width:220px;flex:1">
        <div class="subcard">
          <strong>Streak (gentle)</strong>
          <div style="margin-top:6px;color:rgba(255,255,255,.78)">
            <span id="streakCount" style="font-size:1.3rem;font-weight:1000">0</span> days
          </div>
          <div class="smallNote" style="margin-top:6px;">
            Counts ‚Äúperfect days‚Äù when all 4 checklist items are done.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DAILY MOTIVATION -->
  <div class="card">
    <strong>Today‚Äôs Motivation</strong>
    <p id="dailyQuote" style="margin-top:10px"></p>
    <p style="font-style:italic" id="dailyVerse"></p>
  </div>

  <!-- WEEKLY CHECK IN -->
  <div class="card">
    <strong>Weekly Check-In</strong>
    <input id="ciWeight" placeholder="Weight" />
    <input id="ciWaist" placeholder="Waist (optional)" />
    <textarea id="ciWins" placeholder="Wins this week"></textarea>
    <textarea id="ciStruggles" placeholder="Struggles"></textarea>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
      <button class="btn" onclick="saveCheckIn()">Save Check-In</button>
      <button class="btn2" onclick="renderCheckInHistory()">Refresh History</button>
      <button class="btn2" onclick="exportCheckIns()">Export Check-Ins (JSON)</button>
    </div>
    <div class="subcard" style="margin-top:14px">
      <strong>Check-In History</strong>
      <div id="checkInHistory" style="display:grid;gap:10px;margin-top:12px;"></div>
      <div class="smallNote" style="margin-top:10px">Stored locally on this device.</div>
    </div>
  </div>

  <!-- PROGRESS PHOTOS -->
  <div class="card" id="photos">
    <strong>Progress Photos (max 3/day)</strong>
    <input type="file" accept="image/*" multiple onchange="addPhotos(event)">
    <div id="photoPreview" style="margin-top:12px;"></div>

    <div class="subcard" style="margin-top:14px">
      <strong>Photo Compare</strong>
      <div class="smallNote" style="margin-top:8px">Pick two days to compare (stored locally).</div>
      <div class="grid2" style="margin-top:10px">
        <div>
          <div class="smallNote">Left date</div>
          <select id="compareA" onchange="renderCompare()"></select>
        </div>
        <div>
          <div class="smallNote">Right date</div>
          <select id="compareB" onchange="renderCompare()"></select>
        </div>
      </div>
      <div class="compareWrap" id="compareWrap"></div>
    </div>
  </div>

  <!-- WORKOUT LOG -->
  <div class="card">
    <strong>Today‚Äôs Workout Log</strong>
    <textarea id="workoutLog" placeholder="Weights, reps, notes‚Ä¶"></textarea>
    <button class="btn" onclick="saveWorkout()">Save Workout</button>
  </div>

  <!-- ENERGY MODE -->
  <div class="card">
    <strong>Energy Mode</strong>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
      <button class="btn" style="flex:1;min-width:160px;" onclick="setCycle('follicular')">High Energy ‚ö°Ô∏è</button>
      <button class="btn" style="flex:1;min-width:160px;filter:saturate(.85) brightness(.95);" onclick="setCycle('luteal')">Low Energy ü©∏</button>
    </div>
    <p id="cycleMessage" style="margin-top:12px;color:rgba(255,255,255,.82)"></p>
    <div class="smallNote">Low energy mode = fewer sets/rounds. Still a win.</div>
  </div>

  <!-- TODAY MODE -->
  <div class="card">
    <strong>Today Mode</strong>
    <p id="todayFocus" style="margin-top:10px;color:rgba(255,255,255,.82)"></p>
    <div id="checklist" style="display:grid;gap:10px;margin-top:12px;"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:12px;">
      <span id="checkMetaText" style="color:rgba(255,255,255,.70);font-weight:800;font-size:.9rem;">0 / 4 done</span>
      <button class="btnLink" onclick="resetToday()">Reset today</button>
    </div>
  </div>

  <!-- 26 LB COUNTDOWN -->
  <div class="card">
    <strong>The 26 lb Countdown</strong>
    <p style="margin-top:8px;color:rgba(255,255,255,.72)">Tap a bubble when you lose a pound.</p>
    <div id="trackerGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-top:12px;"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:12px;">
      <span id="trackerCount" style="color:rgba(255,255,255,.70);font-weight:900;">0 / 26 complete</span>
      <button class="btn" style="padding:10px 14px;font-size:.9rem" onclick="resetProgress()">Reset</button>
    </div>
  </div>

  <!-- DAILY FLOW -->
  <div class="section-label" id="flow">THE DAILY FLOW</div>
  <div class="card">
    <div style="display:grid;gap:12px;">
      <div><strong>06:50</strong> ‚Äî Wake & Hydrate <span style="color:rgba(255,255,255,.70)">‚Ä¢ see stack</span></div>
      <div><strong>07:15</strong> ‚Äî Daughter drop-off</div>
      <div><strong>08:30</strong> ‚Äî Son drop-off (M/W/F)</div>
      <div><strong>12:30</strong> ‚Äî High-protein lunch <span style="color:rgba(255,255,255,.70)">‚Ä¢ protein + veg + smart carb</span></div>
      <div><strong>14:30</strong> ‚Äî Pickup</div>

      <div class="subcard">
        <strong>Workout Window (Primary)</strong><br>
        <span style="color:rgba(255,255,255,.75)">3:15‚Äì3:45 ‚Ä¢ 30 minutes</span>
      </div>

      <div class="subcard">
        <strong>Workout Window (Backup)</strong><br>
        <span style="color:rgba(255,255,255,.75)">7:45‚Äì8:15 ‚Ä¢ after kids down</span>
      </div>

      <divtoggleeStyle class="subcard">
        <strong>Snack idea</strong><br>
        <span style="color:rgba(255,255,255,.75)">Protein + crunch (turkey rollups, jerky, protein shake, cottage-cheese alternative)</span>
      </div>

      <div><strong>21:00</strong> ‚Äî Wind-down <span style="color:rgba(255,255,255,.70)">‚Ä¢ stretch / cozy walk</span></div>
    </div>
  </div>

  <!-- MOVES -->
  <div class="section-label" id="moves">THE MOVES (30 MIN)</div>

  <div class="card">
    <strong>How it should feel (quick rules)</strong>
    <ul style="margin-top:10px;color:rgba(255,255,255,.78);line-height:1.5">
      <li><strong>You SHOULD feel:</strong> muscles working, controlled burn, steady breathing.</li>
      <li><strong>You should NOT feel:</strong> sharp joint pain, pinching in low back/neck, numbness/tingling.</li>
      <li><strong>Form rule:</strong> if form breaks, stop the set‚Äîeven if reps aren‚Äôt done.</li>
      <li><strong>Progress rule:</strong> add <strong>+1‚Äì2 reps</strong> or <strong>+2.5‚Äì5 lbs</strong> when it feels ‚Äútoo easy‚Äù.</li>
    </ul>
  </div>

  <!-- MONDAY -->
  <div class="card workout-card" data-day="monday">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div>
        <strong>Monday: Leg Day</strong>
        <div style="color:rgba(255,255,255,.70);margin-top:4px;">Warm-up (5 min): brisk walk + hip circles</div>
      </div>
      <button class="btn" style="padding:10px 14px;font-size:.9rem" onclick="toggleWorkout('monday')">
        <span id="chev-monday">‚ñæ</span> <span id="lbl-monday">Collapse</span>
      </button>
    </div>

    <div id="body-monday" style="margin-top:14px;overflow:hidden;">
      <div class="ex" data-exid="monday-goblet">
        <strong>1) Goblet Squat</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)">
          <span class="sets" data-high="3" data-low="2"></span> √ó 10‚Äì12 ‚Ä¢ Rest 60s
        </div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Do:</em> chest up, knees track over toes. <em>Don‚Äôt:</em> collapse knees inward.</div>
      </div>

      <hr>

      <div class="ex" data-exid="monday-lunge">
        <strong>2) Reverse Lunge</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)">
          <span class="sets" data-high="3" data-low="2"></span> √ó 8‚Äì10/leg ‚Ä¢ Rest 60s
        </div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> glute/quad. <em>Don‚Äôt:</em> slam knee or lean forward.</div>
      </div>

      <hr>

      <div class="ex" data-exid="monday-hiphinge">
        <strong>3) DB Romanian Deadlift</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)">
          <span class="sets" data-high="3" data-low="2"></span> √ó 10‚Äì12 ‚Ä¢ Rest 60s
        </div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> hamstrings stretching. <em>Don‚Äôt:</em> round back.</div>
      </div>

      <hr>

      <div class="ex" data-exid="monday-finisher">
        <strong>4) 2-Min Finisher: Wall Sit</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)">2 rounds: 45s hold + 15s rest</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> quad burn. <em>Don‚Äôt:</em> hold breath.</div>
      </div>

      <div class="subcard">
        <strong>Cool-down (3‚Äì5 min):</strong><br>
        <span style="color:rgba(255,255,255,.72)">Quad stretch ‚Ä¢ Hamstring stretch ‚Ä¢ Figure-4 glute stretch</span>
      </div>

      <button class="btn" style="margin-top:14px;width:100%" onclick="saveExerciseLogs()">Save Today‚Äôs Exercise Logs</button>
    </div>
  </div>

  <!-- TUESDAY -->
  <div class="card workout-card" data-day="tuesday">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div>
        <strong>Tuesday: Core + Pilates</strong>
        <div style="color:rgba(255,255,255,.70);margin-top:4px;">Warm-up (3 min): cat/cow + deep breaths</div>
      </div>
      <button class="btn" style="padding:10px 14px;font-size:.9rem" onclick="toggleWorkout('tuesday')">
        <span id="chev-tuesday">‚ñæ</span> <span id="lbl-tuesday">Collapse</span>
      </button>
    </div>

    <div id="body-tuesday" style="margin-top:14px;overflow:hidden;">
      <div class="ex" data-exid="tuesday-birddog">
        <strong>1) Bird Dog</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 10‚Äì12/side ‚Ä¢ Rest 30s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> deep core. <em>Don‚Äôt:</em> rotate hips.</div>
      </div>

      <hr>

      <div class="ex" data-exid="tuesday-deadbug">
        <strong>2) Dead Bug</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 8‚Äì10/side ‚Ä¢ Rest 30s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>You should feel:</em> abs holding spine. <em>Don‚Äôt:</em> low back arch.</div>
      </div>

      <hr>

      <div class="ex" data-exid="tuesday-sideplank">
        <strong>3) Side Plank</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 20‚Äì30s/side ‚Ä¢ Rest 30s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> obliques. <em>Don‚Äôt:</em> sink shoulder.</div>
      </div>

      <hr>

      <div class="ex" data-exid="tuesday-glutebridge">
        <strong>4) Glute Bridge</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 12‚Äì15 ‚Ä¢ Rest 30‚Äì45s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> glutes at the top. <em>Don‚Äôt:</em> push through low back.</div>
      </div>

      <div class="subcard">
        <strong>Cool-down (3 min):</strong><br>
        <span style="color:rgba(255,255,255,.72)">Child‚Äôs pose ‚Ä¢ Supine twist ‚Ä¢ Deep breathing</span>
      </div>

      <button class="btn" style="margin-top:14px;width:100%" onclick="saveExerciseLogs()">Save Today‚Äôs Exercise Logs</button>
    </div>
  </div>

  <!-- WEDNESDAY -->
  <div class="card workout-card" data-day="wednesday">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div>
        <strong>Wednesday: Upper Body</strong>
        <div style="color:rgba(255,255,255,.70);margin-top:4px;">Warm-up (5 min): arm circles + light rows</div>
      </div>
      <button class="btn" style="padding:10px 14px;font-size:.9rem" onclick="toggleWorkout('wednesday')">
        <span id="chev-wednesday">‚ñæ</span> <span id="lbl-wednesday">Collapse</span>
      </button>
    </div>

    <div id="body-wednesday" style="margin-top:14px;overflow:hidden;">
      <div class="ex" data-exid="wed-press">
        <strong>1) DB Overhead Press</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 8‚Äì10 ‚Ä¢ Rest 60s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> shoulders/triceps. <em>Don‚Äôt:</em> arch low back.</div>
      </div>

      <hr>

      <div class="ex" data-exid="wed-row">
        <strong>2) DB Row</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 10‚Äì12 ‚Ä¢ Rest 60s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> lats/upper back. <em>Don‚Äôt:</em> shrug shoulder to ear.</div>
      </div>

      <hr>

      <div class="ex" data-exid="wed-lateral">
        <strong>3) Lateral Raise</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)"><span class="sets" data-high="3" data-low="2"></span> √ó 12‚Äì15 ‚Ä¢ Rest 45s</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> side delts. <em>Don‚Äôt:</em> swing weights.</div>
      </div>

      <hr>

      <div class="ex" data-exid="wed-arms">
        <strong>4) Arms Finisher</strong>
        <div style="margin-top:6px;color:rgba(255,255,255,.75)">2 rounds: curls 12 + tricep kickbacks 12 (minimal rest)</div>
        <div style="margin-top:8px;color:rgba(255,255,255,.72)"><em>Feel:</em> pump. <em>Don‚Äôt:</em> lock elbows hard.</div>
      </div>

      <div class="subcard">
        <strong>Cool-down (3‚Äì5 min):</strong><br>
        <span style="color:rgba(255,255,255,.72)">Chest doorway stretch ‚Ä¢ Upper back stretch ‚Ä¢ Neck gentle stretch</span>
      </div>

      <button class="btn" style="margin-top:14px;width:100%" onclick="saveExerciseLogs()">Save Today‚Äôs Exercise Logs</button>
    </div>
  </div>

  <!-- THURSDAY -->
  <div class="card workout-card" data-day="thursday">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div>
        <strong>Thursday: Full Body Circuit</strong>
        <div style="color:rgba(255,255,255,.70);margin-top:4px;">Warm-up (5 min): walk + bodyweight squats + shoulder rolls</div>
      </div>
      <button class="btn" style="padding:10px 14px;font-size:.9rem" onclick="toggleWorkout('thursday')">
        <span id="chev-thursday">‚ñæ</span> <span id="lbl-thursday">Collapse</span>
      </button>
    </div>

    <div id="body-thursday" style="margin-top:14px;overflow:hidden;">
      <div style="color:rgba(255,255,255,.78)">
        <strong>Circuit:</strong> do moves 1‚Äì4, rest 60‚Äì90s, repeat.
        <div style="margin-top:8px;"><span class="sets" data-high="3" data-low="2" data-label="rounds"></span> total</div>
      </div>

      <hr>

      <div class="ex" data-exid="thu-squat">
        <strong>1) Squat</strong>
        <div style="color:rgba(255,255,255,.75);margin-top:6px;">10‚Äì12 reps</div>
      </div>

      <div class="ex" data-exid="thu-push">
        <strong>2) Push (incline push-up or DB press)</strong>
        <div style="color:rgba(255,255,255,.75);margin-top:6px;">8‚Äì12 reps</div>
      </div>

      <div class="ex" data-exid="thu-pull">
        <strong>3) Pull (row)</strong>
        <div style="color:rgba(255,255,255,.75);margin-top:6px;">10‚Äì12 reps</div>
      </div>

      <div class="ex" data-exid="thu-core">
        <strong>4) Core (mountain climbers)</strong>
        <div style="color:rgba(255,255,255,.75);margin-top:6px;">20‚Äì30 seconds</div>
      </div>

      <div class="subcard">
        <strong>Cool-down (3 min):</strong><br>
        <span style="color:rgba(255,255,255,.72)">Hamstring stretch ‚Ä¢ Quad stretch ‚Ä¢ Child‚Äôs pose</span>
      </div>

      <button class="btn" style="margin-top:14px;width:100%" onclick="saveExerciseLogs()">Save Today‚Äôs Exercise Logs</button>
    </div>
  </div>

  <!-- FOOD -->
  <div class="section-label" id="food">FOOD PLAYBOOK (EASY MODE)</div>
  <div class="card">
    <strong>Rules that actually work</strong>
    <div class="pills">
      <div class="pill">Protein first</div>
      <div class="pill">Fiber + water</div>
      <div class="pill">Carbs on purpose</div>
      <div class="pill">80% consistent</div>
    </div>

    <div class="subcard">
      <strong>Portions: His vs Hers (quick guide)</strong>
      <div class="grid2" style="margin-top:10px">
        <div>
          <div class="badge">Hers</div>
          <div style="margin-top:8px;color:rgba(255,255,255,.78)">
            <strong>Protein:</strong> 25‚Äì35g/meal<br>
            <strong>Carb:</strong> 0‚Äì1 fist (workout days = 1)<br>
            <strong>Fat:</strong> 1 thumb<br>
            <strong>Veg:</strong> 2 fists
          </div>
        </div>
        <div>
          <div class="badge">His</div>
          <div style="margin-top:8px;color:rgba(255,255,255,.78)">
            <strong>Protein:</strong> 40‚Äì55g/meal<br>
            <strong>Carb:</strong> 1 fist (more if bulking)<br>
            <strong>Fat:</strong> 1‚Äì2 thumbs<br>
            <strong>Veg:</strong> 2 fists
          </div>
        </div>
      </div>
      <div class="smallNote" style="margin-top:10px">
        ‚ÄúFist‚Äù and ‚Äúthumb‚Äù are hand-size portions. Keeps it simple.
      </div>
    </div>

    <div class="subcard">
      <strong>3 repeatable lunches (pick one)</strong>
      <ul style="margin-top:10px;color:rgba(255,255,255,.78);line-height:1.55">
        <li><strong>Chicken salad bowl:</strong> rotisserie chicken + greens + cucumber + cheese (optional) + light dressing</li>
        <li><strong>Taco bowl:</strong> ground turkey + salsa + lettuce + avocado + (workout days: small rice)</li>
        <li><strong>‚ÄúAdult lunchable‚Äù:</strong> turkey slices + string cheese + pickles + almonds + berries</li>
      </ul>
    </div>

    <div class="subcard">
      <strong>3 easy dinners</strong>
      <ul style="margin-top:10px;color:rgba(255,255,255,.78);line-height:1.55">
        <li><strong>Sheet pan:</strong> salmon/chicken + broccoli + olive oil + seasoning</li>
        <li><strong>Burger night:</strong> bunless or thin bun + side salad + fries for kids</li>
        <li><strong>Stir-fry:</strong> frozen veg + protein + sauce (go easy) + cauliflower rice</li>
      </ul>
    </div>

    <div class="subcard">
      <strong>Snack list (protein + crunch)</strong>
      <div class="pills">
        <div class="pill">Turkey roll-ups</div>
        <div class="pill">Jerky</div>
        <div class="pill">Protein shake</div>
        <div class="pill">Cucumbers + ranch</div>
        <div class="pill">Eggs</div>
        <div class="pill">Edamame</div>
      </div>
      <div class="smallNote" style="margin-top:10px">
        (Replaced yogurt-style snacks with non-yogurt options.)
      </div>
    </div>
  </div>

  <!-- STACK -->
  <div class="section-label" id="stack">THE STACK (DETAILED, NOT OVERWHELMING)</div>
  <div class="card">
    <strong>Simple rule:</strong> If it feels overwhelming, skip the ‚Äúoptional‚Äù stuff and just do water + protein + sleep.

    <details class="acc" open>
      <summary>
        <span>Morning (06:50) ‚Äî Hydration + baseline</span>
        <span class="badge">Daily</span>
      </summary>
      <div class="body">
        <div><strong>Water (big glass)</strong> ‚Äî jumpstarts energy + reduces ‚Äúfalse hunger.‚Äù</div>
        <div style="margin-top:8px"><strong>Electrolytes (optional)</strong> ‚Äî helps hydration stick, especially if sweating or you get headaches.</div>
        <div style="margin-top:8px"><strong>Multivitamin (optional)</strong> ‚Äî ‚Äúnutrition insurance,‚Äù not magic. Food still wins.</div>
        <div class="smallNote" style="margin-top:10px">If any supplements upset your stomach, take with food later.</div>
      </div>
    </details>

    <details class="acc">
      <summary>
        <span>Workout window ‚Äî performance + recovery</span>
        <span class="badge">Most days</span>
      </summary>
      <div class="body">
        <div><strong>Protein after</strong> ‚Äî reduces cravings later and supports muscle (the ‚Äútight & toned‚Äù look).</div>
        <div style="margin-top:8px"><strong>Creatine (optional)</strong> ‚Äî helps strength and workout consistency. (Not a stimulant.)</div>
        <div class="smallNote" style="margin-top:10px">If you don‚Äôt want supplements: just eat protein within a couple hours.</div>
      </div>
    </details>

    <details class="acc">
      <summary>
        <span>Night ‚Äî sleep quality + stress reset</span>
        <span class="badge">Daily</span>
      </summary>
      <div class="body">
        <div><strong>3‚Äì5 min stretch</strong> ‚Äî turns off ‚Äúfight or flight‚Äù and reduces stiffness.</div>
        <div style="margin-top:8px"><strong>Magnesium glycinate (optional)</strong> ‚Äî supports sleep + muscle relaxation.</div>
        <div class="smallNote" style="margin-top:10px">If sleep is rough: dim lights, no doom-scroll, keep it boring.</div>
      </div>
    </details>

    <details class="acc">
      <summary>
        <span>Your custom items</span>
        <span class="badge">Edit me</span>
      </summary>
      <div class="body">
        <div class="smallNote">Add anything your doctor told you to take. This section is intentionally customizable.</div>
        <textarea id="customStack" placeholder="Example: Vitamin D (morning), Fish oil (with lunch), etc..."></textarea>
        <button class="btn2" style="margin-top:10px;width:100%" onclick="saveCustomStack()">Save Custom Stack Notes</button>
      </div>
    </details>

    <div class="smallNote" style="margin-top:12px">
      Note: This is a wellness guide ‚Äî meds/supplements should follow her doctor‚Äôs instructions.
    </div>
  </div>

  <!-- PHOTO GALLERY -->
  <div class="section-label">PROGRESS PHOTO GALLERY</div>
  <div class="card">
    <strong>Browse saved days</strong>
    <p style="color:rgba(255,255,255,.72);margin-top:8px;">All photos are stored locally on this device (not uploaded anywhere).</p>
    <div id="galleryList" style="display:grid;gap:12px;margin-top:12px;"></div>
    <button class="btn" style="margin-top:12px;width:100%" onclick="clearAllPhotos()">Clear ALL stored photos</button>
  </div>

</div><!-- /.container -->

<!-- CONFETTI BUTTON -->
<div class="float">
  <button class="btn" style="padding:16px 22px;font-size:1.05rem" onclick="fireConfetti()">I CRUSHED IT! üéä</button>
</div>

<!-- BOTTOM NAV -->
<div class="nav">
  <div class="navRow">
    <a href="#today"><span>‚ú®</span>Today</a>
    <a href="#flow"><span>üóìÔ∏è</span>Flow</a>
    <a href="#moves"><span>üèãÔ∏è</span>Moves</a>
    <a href="#food"><span>ü•ó</span>Food</a>
    <a href="#stack"><span>üíä</span>Stack</a>
    <a href="#photos"><span>üì∏</span>Photos</a>
  </div>
  <div class="navHint">Tap a tab ‚Ä¢ Scroll is fine too ‚Ä¢ Everything saves on this phone</div>
</div>

<script>
/* ============ Helper: add log inputs to any .ex with data-exid ============ */
function ensureLogInputs(){
  document.querySelectorAll(".ex[data-exid]").forEach(ex=>{
    if(ex.querySelector("input.log")) return;
    const wrap = document.createElement("div");
    wrap.style.marginTop = "10px";
    wrap.innerHTML = `
      <input class="log" placeholder="Last: ___ (lbs/reps/time)" />
      <input class="log" placeholder="Today: ___ (lbs/reps/time)" />
    `;
    ex.appendChild(wrap);
  });
}

/** =========================
 *  STORAGE
 *  ========================= */
const STORAGE = {
  progress: "bgwProgress26",
  phase: "bgwPhase",
  today: "bgwDailyChecklist",
  checkins: "bgwWeeklyCheckins",
  photos: "bgwDailyPhotos",
  workoutLog: "bgwWorkoutLog",
  exerciseLogs: "bgwExerciseLogs",
  workoutCollapsed: "bgwWorkoutCollapsed",
  customStack: "bgwCustomStackNotes"
};

function safeParse(json, fallback) {
  try { return JSON.parse(json) ?? fallback; } catch { return fallback; }
}
function todayKey() {
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth() + 1).padStart(2, "0");
  const dd = String(d.getDate()).padStart(2, "0");
  return `${yyyy}-${mm}-${dd}`;
}
function dayNameLower() {
  return new Date().toLocaleDateString(undefined, { weekday: "long" }).toLowerCase();
}
function prettyDay() {
  const d = new Date();
  return d.toLocaleDateString(undefined, { weekday:"long", month:"short", day:"numeric" });
}
function dateSeed() {
  const k = todayKey();
  let h = 0;
  for (let i = 0; i < k.length; i++) h = (h * 31 + k.charCodeAt(i)) >>> 0;
  return h;
}

/** DAILY HEADER */
document.getElementById("dailyHeader").textContent = `Her Era ‚Ä¢ ${prettyDay()} Edition`;

/** ONE THING */
const oneThings = [
  "Hit your protein today (even if nothing else is perfect).",
  "Take a 10-minute walk. Momentum counts.",
  "Do the workout window ‚Äî 30 minutes. In and out.",
  "Hydrate early so you don‚Äôt crash later.",
  "Sleep is the secret weapon. Protect it."
];
document.getElementById("oneThing").textContent = oneThings[dateSeed() % oneThings.length];

/** QUOTE + VERSE */
const quotes = [
  "Small steps, loud results.",
  "Consistency is the real glow-up.",
  "You don‚Äôt need motivation. You need a plan.",
  "Do it messy. Do it anyway.",
  "Future Bailey is cheering for you.",
  "You‚Äôre not behind. You‚Äôre building."
];
const verses = [
  "‚ÄúI can do all things through Christ who strengthens me.‚Äù ‚Äî Philippians 4:13",
  "‚ÄúLet us not grow weary of doing good...‚Äù ‚Äî Galatians 6:9",
  "‚ÄúBe strong and courageous...‚Äù ‚Äî Joshua 1:9",
  "‚ÄúThe joy of the Lord is your strength.‚Äù ‚Äî Nehemiah 8:10",
  "‚ÄúCommit your work to the Lord...‚Äù ‚Äî Proverbs 16:3",
  "‚ÄúHe gives strength to the weary...‚Äù ‚Äî Isaiah 40:29"
];
document.getElementById("dailyQuote").textContent = quotes[dateSeed() % quotes.length];
document.getElementById("dailyVerse").textContent = verses[(dateSeed() + 2) % verses.length];

/** CYCLE MODE + AUTO SETS */
let currentPhase = localStorage.getItem(STORAGE.phase) || "follicular";
function applyAutoSets() {
  const isLow = currentPhase === "luteal";
  document.querySelectorAll(".sets").forEach(el => {
    const high = Number(el.getAttribute("data-high") || "3");
    const low = Number(el.getAttribute("data-low") || "2");
    const n = isLow ? low : high;
    const label = el.getAttribute("data-label") || "sets";
    el.textContent = `${n} ${label}`;
  });
  document.getElementById("cycleMessage").textContent = isLow
    ? "Low Energy mode: fewer sets/rounds, lighter weights, still a win."
    : "High Energy mode: full sets, push progress safely.";
}
function setCycle(phase) {
  currentPhase = phase;
  localStorage.setItem(STORAGE.phase, phase);
  applyAutoSets();
}
applyAutoSets();

/** TODAY FOCUS */
const today = dayNameLower();
const workoutLabelByDay = {
  monday: "Leg Day",
  tuesday: "Core + Pilates",
  wednesday: "Upper Body",
  thursday: "Full Body Circuit",
  friday: "Recovery",
  saturday: "Recovery",
  sunday: "Recovery"
};
document.getElementById("todayFocus").textContent =
  `Focus: ${workoutLabelByDay[today] || "Recovery"} ‚Äî aim for the 3:15 workout window.`;

/** CHECKLIST */
const checklistEl = document.getElementById("checklist");
const checkMetaText = document.getElementById("checkMetaText");

const defaultChecklist = [
  { id: "water", title: "Hydrate", sub: "Water + morning essentials" },
  { id: "protein", title: "Protein", sub: "High-protein lunch + snack" },
  { id: "move", title: "Movement", sub: "Workout window or walk" },
  { id: "sleep", title: "Recovery", sub: "Magnesium + wind-down" }
];

function loadDailyState() {
  const all = safeParse(localStorage.getItem(STORAGE.today), {});
  const key = todayKey();
  return { all, key, state: all[key] || { done: {} } };
}
function saveDailyState(all) { localStorage.setItem(STORAGE.today, JSON.stringify(all)); }

function renderChecklist() {
  const { all, key, state } = loadDailyState();
  checklistEl.innerHTML = "";
  let doneCount = 0;

  defaultChecklist.forEach(item => {
    const isDone = Boolean(state.done[item.id]);
    if (isDone) doneCount++;

    const row = document.createElement("div");
    row.style.padding = "12px";
    row.style.borderRadius = "16px";
    row.style.border = "1px solid rgba(255,255,255,.12)";
    row.style.background = isDone ? "rgba(166,255,77,.10)" : "rgba(255,255,255,.06)";
    row.style.display = "flex";
    row.style.gap = "12px";
    row.style.alignItems = "flex-start";
    row.style.cursor = "pointer";

    row.innerHTML = `
      <div style="width:24px;height:24px;border-radius:8px;border:2px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;">
        ${isDone ? "‚úì" : ""}
      </div>
      <div>
        <div style="font-weight:900">${item.title}</div>
        <div style="color:rgba(255,255,255,.70);font-size:.9rem;margin-top:2px">${item.sub}</div>
      </div>
    `;

    row.addEventListener("click", () => {
      state.done[item.id] = !Boolean(state.done[item.id]);
      all[key] = state;
      saveDailyState(all);
      renderChecklist();
      updateStreak();
      if (state.done[item.id]) fireConfetti();
    });

    checklistEl.appendChild(row);
  });

  checkMetaText.textContent = `${doneCount} / ${defaultChecklist.length} done`;
}
function resetToday() {
  if (!confirm("Reset today‚Äôs checklist?")) return;
  const { all, key } = loadDailyState();
  delete all[key];
  saveDailyState(all);
  renderChecklist();
  updateStreak();
}
renderChecklist();

/** Streak: counts consecutive days where all 4 checklist tasks were done */
function updateStreak(){
  const all = safeParse(localStorage.getItem(STORAGE.today), {});
  const keys = Object.keys(all).sort(); // yyyy-mm-dd lex sort works
  if(!keys.length){ document.getElementById("streakCount").textContent = "0"; return; }

  // build a set of "perfect days"
  const perfect = new Set();
  keys.forEach(k=>{
    const st = all[k] || {};
    const done = (st.done || {});
    const ok = defaultChecklist.every(it => Boolean(done[it.id]));
    if(ok) perfect.add(k);
  });

  // count backwards from today while consecutive days are perfect
  let streak = 0;
  let d = new Date();
  for(;;){
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const k = `${yyyy}-${mm}-${dd}`;
    if(perfect.has(k)){
      streak++;
      d.setDate(d.getDate()-1);
      continue;
    }
    break;
  }
  document.getElementById("streakCount").textContent = String(streak);
}
updateStreak();

/** 26 LB TRACKER */
const grid = document.getElementById("trackerGrid");
const totalPounds = 26;
let progress = safeParse(localStorage.getItem(STORAGE.progress), []);
function renderCount() {
  document.getElementById("trackerCount").textContent = `${progress.length} / ${totalPounds} complete`;
}
function saveProgress() {
  localStorage.setItem(STORAGE.progress, JSON.stringify(progress));
  renderCount();
}
function resetProgress() {
  if (!confirm("Reset the 26-lb tracker?")) return;
  progress = [];
  localStorage.removeItem(STORAGE.progress);
  document.querySelectorAll(".lb").forEach(b => b.style.background = "rgba(255,255,255,.06)");
  renderCount();
}
for (let i = 0; i < totalPounds; i++) {
  const bubble = document.createElement("div");
  bubble.className = "lb";
  bubble.textContent = i + 1;

  if (progress.includes(i)) {
    bubble.style.background = "linear-gradient(180deg, rgba(255,59,212,.95), rgba(57,245,255,.85))";
    bubble.style.color = "#07070c";
  }

  bubble.addEventListener("click", () => {
    const idx = i;
    const checked = progress.includes(idx);
    if (checked) {
      progress = progress.filter(p => p !== idx);
      bubble.style.background = "rgba(255,255,255,.06)";
      bubble.style.color = "rgba(255,255,255,.70)";
    } else {
      progress.push(idx);
      bubble.style.background = "linear-gradient(180deg, rgba(255,59,212,.95), rgba(57,245,255,.85))";
      bubble.style.color = "#07070c";
      fireConfetti();
    }
    saveProgress();
  });

  grid.appendChild(bubble);
}
renderCount();

/** WORKOUT COLLAPSE */
let workoutCollapsed = safeParse(localStorage.getItem(STORAGE.workoutCollapsed), {});
function toggleWorkout(day) {
  const body = document.getElementById(`body-${day}`);
  const chev = document.getElementById(`chev-${day}`);
  const lbl = document.getElementById(`lbl-${day}`);
  const isCollapsed = Boolean(workoutCollapsed[day]);
  const next = !isCollapsed;

  workoutCollapsed[day] = next;
  localStorage.setItem(STORAGE.workoutCollapsed, JSON.stringify(workoutCollapsed));

  if (next) {
    body.style.display = "none";
    chev.textContent = "‚ñ∏";
    lbl.textContent = "Expand";
  } else {
    body.style.display = "block";
    chev.textContent = "‚ñæ";
    lbl.textContent = "Collapse";
  }
}
["monday","tuesday","wednesday","thursday"].forEach(day => {
  if (workoutCollapsed[day]) toggleWorkout(day);
});

/** WEEKLY CHECK-IN */
function weekKey(d=new Date()){
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
  return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,"0")}`;
}
function saveCheckIn(){
  const all = safeParse(localStorage.getItem(STORAGE.checkins), {});
  const key = weekKey();
  all[key] = {
    date: todayKey(),
    weight: document.getElementById("ciWeight").value.trim(),
    waist: document.getElementById("ciWaist").value.trim(),
    wins: document.getElementById("ciWins").value.trim(),
    struggles: document.getElementById("ciStruggles").value.trim()
  };
  localStorage.setItem(STORAGE.checkins, JSON.stringify(all));
  alert("Weekly check-in saved locally ‚úÖ");
  renderCheckInHistory();
}
function renderCheckInHistory(){
  const wrap = document.getElementById("checkInHistory");
  if(!wrap) return;
  const all = safeParse(localStorage.getItem(STORAGE.checkins), {});
  const keys = Object.keys(all).sort().reverse();
  wrap.innerHTML = "";

  if(!keys.length){
    wrap.innerHTML = `<div style="color:rgba(255,255,255,.65)">No check-ins saved yet.</div>`;
    return;
  }

  keys.forEach(k=>{
    const item = all[k] || {};
    const card = document.createElement("div");
    card.style.padding = "12px";
    card.style.borderRadius = "16px";
    card.style.border = "1px solid rgba(255,255,255,.12)";
    card.style.background = "rgba(255,255,255,.06)";

    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap">
        <div>
          <strong>${k}</strong>
          <div style="color:rgba(255,255,255,.70);margin-top:4px">Saved: ${item.date || "‚Äî"}</div>
        </div>
        <button class="btn2" style="padding:10px 12px" onclick="deleteCheckIn('${k}')">Delete</button>
      </div>
      <div style="margin-top:10px;color:rgba(255,255,255,.80);line-height:1.55">
        <div><strong>Weight:</strong> ${escapeHtml(item.weight || "‚Äî")} &nbsp; <strong>Waist:</strong> ${escapeHtml(item.waist || "‚Äî")}</div>
        <div style="margin-top:8px"><strong>Wins:</strong> ${escapeHtml(item.wins || "‚Äî")}</div>
        <div style="margin-top:8px"><strong>Struggles:</strong> ${escapeHtml(item.struggles || "‚Äî")}</div>
      </div>
    `;
    wrap.appendChild(card);
  });
}
function deleteCheckIn(key){
  if(!confirm(`Delete ${key}?`)) return;
  const all = safeParse(localStorage.getItem(STORAGE.checkins), {});
  delete all[key];
  localStorage.setItem(STORAGE.checkins, JSON.stringify(all));
  renderCheckInHistory();
}
function exportCheckIns(){
  const all = safeParse(localStorage.getItem(STORAGE.checkins), {});
  const blob = new Blob([JSON.stringify(all, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "bailey-checkins.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}
renderCheckInHistory();

/** WORKOUT LOG (TEXT) */
function saveWorkout(){
  const all = safeParse(localStorage.getItem(STORAGE.workoutLog), {});
  all[todayKey()] = document.getElementById("workoutLog").value;
  localStorage.setItem(STORAGE.workoutLog, JSON.stringify(all));
  alert("Workout log saved locally ‚úÖ");
}

/** EXERCISE LOGS */
function saveExerciseLogs(){
  const all = safeParse(localStorage.getItem(STORAGE.exerciseLogs), {});
  const key = todayKey();
  all[key] = all[key] || {};

  document.querySelectorAll(".ex[data-exid]").forEach(ex => {
    const id = ex.getAttribute("data-exid");
    const inputs = Array.from(ex.querySelectorAll("input.log")).map(i => i.value.trim()).filter(Boolean);
    if (inputs.length) all[key][id] = inputs;
  });

  localStorage.setItem(STORAGE.exerciseLogs, JSON.stringify(all));
  alert("Exercise logs saved locally ‚úÖ");
}

/** CUSTOM STACK NOTES */
function saveCustomStack(){
  const val = document.getElementById("customStack").value || "";
  localStorage.setItem(STORAGE.customStack, val);
  alert("Saved ‚úÖ");
}
(function loadCustomStack(){
  const val = localStorage.getItem(STORAGE.customStack) || "";
  const el = document.getElementById("customStack");
  if(el) el.value = val;
})();

/** PHOTOS */
function loadPhotosAll(){ return safeParse(localStorage.getItem(STORAGE.photos), {}); }
function savePhotosAll(all){ localStorage.setItem(STORAGE.photos, JSON.stringify(all)); }

async function fileToCompressedDataURL(file){
  const img = document.createElement("img");
  const url = URL.createObjectURL(file);
  img.src = url;
  await new Promise(res => img.onload = res);

  const maxSide = 900;
  let { width:w, height:h } = img;
  const scale = Math.min(1, maxSide / Math.max(w,h));
  w = Math.round(w * scale); h = Math.round(h * scale);

  const canvas = document.createElement("canvas");
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, w, h);

  URL.revokeObjectURL(url);
  return canvas.toDataURL("image/jpeg", 0.75);
}

async function addPhotos(e){
  const files = Array.from(e.target.files || []);
  if (!files.length) return;

  const all = loadPhotosAll();
  const key = todayKey();
  all[key] = all[key] || [];

  const room = 3 - all[key].length;
  if (room <= 0) { alert("Max 3 photos saved for today."); return; }

  const slice = files.slice(0, room);
  for (const f of slice){
    const dataUrl = await fileToCompressedDataURL(f);
    all[key].push(dataUrl);
  }

  savePhotosAll(all);
  renderTodayPhotos();
  renderGallery();
  renderCompareSelectors();
  renderCompare();
  e.target.value = "";
}

function renderTodayPhotos(){
  const all = loadPhotosAll();
  const key = todayKey();
  const wrap = document.getElementById("photoPreview");
  if (!wrap) return;
  wrap.innerHTML = "";

  const list = all[key] || [];
  if (!list.length) {
    wrap.innerHTML = `<div style="color:rgba(255,255,255,.65)">No photos saved today yet.</div>`;
    return;
  }

  const row = document.createElement("div");
  row.style.display = "flex";
  row.style.gap = "10px";
  row.style.flexWrap = "wrap";

  list.forEach((src, idx) => {
    const box = document.createElement("div");
    box.style.position = "relative";
    box.style.width = "96px";
    box.style.height = "96px";
    box.style.borderRadius = "16px";
    box.style.overflow = "hidden";
    box.style.border = "1px solid rgba(255,255,255,.12)";
    box.style.background = "rgba(255,255,255,.06)";

    const img = document.createElement("img");
    img.src = src;
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "cover";

    const del = document.createElement("button");
    del.textContent = "‚úï";
    del.style.position = "absolute";
    del.style.top = "6px";
    del.style.right = "6px";
    del.style.border = "none";
    del.style.borderRadius = "10px";
    del.style.padding = "6px 8px";
    del.style.background = "rgba(0,0,0,.55)";
    del.style.color = "white";
    del.style.fontWeight = "900";
    del.onclick = () => removePhotoForDay(key, idx);

    box.appendChild(img);
    box.appendChild(del);
    row.appendChild(box);
  });

  wrap.appendChild(row);
  const note = document.createElement("div");
  note.style.marginTop = "10px";
  note.style.color = "rgba(255,255,255,.70)";
  note.style.fontWeight = "800";
  note.textContent = `${list.length} / 3 saved today`;
  wrap.appendChild(note);
}

function removePhotoForDay(dayKey, index){
  const all = loadPhotosAll();
  if (!all[dayKey]) return;
  all[dayKey].splice(index, 1);
  savePhotosAll(all);
  renderTodayPhotos();
  renderGallery();
  renderCompareSelectors();
  renderCompare();
}

function renderGallery(){
  const all = loadPhotosAll();
  const listEl = document.getElementById("galleryList");
  if (!listEl) return;
  listEl.innerHTML = "";

  const keys = Object.keys(all).sort().reverse();
  if (!keys.length){
    listEl.innerHTML = `<div style="color:rgba(255,255,255,.65)">No photos saved yet.</div>`;
    return;
  }

  keys.forEach(k => {
    const photos = all[k] || [];
    const card = document.createElement("div");
    card.style.padding = "12px";
    card.style.borderRadius = "16px";
    card.style.border = "1px solid rgba(255,255,255,.12)";
    card.style.background = "rgba(255,255,255,.06)";

    const top = document.createElement("div");
    top.style.display = "flex";
    top.style.justifyContent = "space-between";
    top.style.alignItems = "center";
    top.style.gap = "10px";
    top.innerHTML = `
      <strong>${k}</strong>
      <span style="color:rgba(255,255,255,.70);font-weight:900">${photos.length} photo(s)</span>
    `;
    card.appendChild(top);

    const row = document.createElement("div");
    row.style.display = "flex";
    row.style.gap = "10px";
    row.style.marginTop = "10px";
    row.style.flexWrap = "wrap";

    photos.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.style.width = "86px";
      img.style.height = "86px";
      img.style.objectFit = "cover";
      img.style.borderRadius = "14px";
      img.style.border = "1px solid rgba(255,255,255,.12)";
      row.appendChild(img);
    });

    card.appendChild(row);
    listEl.appendChild(card);
  });
}

function clearAllPhotos(){
  if (!confirm("This deletes ALL stored photos on this device. Continue?")) return;
  localStorage.removeItem(STORAGE.photos);
  renderTodayPhotos();
  renderGallery();
  renderCompareSelectors();
  renderCompare();
}

function renderCompareSelectors(){
  const all = loadPhotosAll();
  const keys = Object.keys(all).sort().reverse().filter(k => (all[k]||[]).length);
  const a = document.getElementById("compareA");
  const b = document.getElementById("compareB");
  if(!a || !b) return;

  const currentA = a.value;
  const currentB = b.value;

  a.innerHTML = "";
  b.innerHTML = "";

  const noneOpt = (label) => {
    const o = document.createElement("option");
    o.value = "";
    o.textContent = label;
    return o;
  };

  a.appendChild(noneOpt("Select a date‚Ä¶"));
  b.appendChild(noneOpt("Select a date‚Ä¶"));

  keys.forEach(k=>{
    const oa = document.createElement("option"); oa.value = k; oa.textContent = k;
    const ob = document.createElement("option"); ob.value = k; ob.textContent = k;
    a.appendChild(oa); b.appendChild(ob);
  });

  if(keys.includes(currentA)) a.value = currentA;
  if(keys.includes(currentB)) b.value = currentB;

  // default selections if empty
  if(!a.value && keys[0]) a.value = keys[0];
  if(!b.value && keys[1]) b.value = keys[1] || keys[0];
}

function renderCompare(){
  const wrap = document.getElementById("compareWrap");
  const all = loadPhotosAll();
  const a = document.getElementById("compareA")?.value || "";
  const b = document.getElementById("compareB")?.value || "";
  if(!wrap) return;

  wrap.innerHTML = "";

  const pickFirst = (!a && !b);
  if(pickFirst){
    wrap.innerHTML = `<div style="color:rgba(255,255,255,.65)">Save photos for at least one day to use compare.</div>`;
    return;
  }

  const left = (all[a]||[])[0];
  const right = (all[b]||[])[0];

  const leftBox = document.createElement("div");
  const rightBox = document.createElement("div");

  leftBox.innerHTML = `<div class="smallNote">${a || "‚Äî"}</div>`;
  rightBox.innerHTML = `<div class="smallNote">${b || "‚Äî"}</div>`;

  const li = document.createElement("img");
  li.src = left || "";
  li.alt = a;
  if(!left) li.style.display = "none";

  const ri = document.createElement("img");
  ri.src = right || "";
  ri.alt = b;
  if(!right) ri.style.display = "none";

  leftBox.appendChild(li);
  rightBox.appendChild(ri);

  wrap.appendChild(leftBox);
  wrap.appendChild(rightBox);

  if(!left && !right){
    wrap.innerHTML = `<div style="color:rgba(255,255,255,.65)">No photos available for selected dates.</div>`;
  }
}

renderTodayPhotos();
renderGallery();
renderCompareSelectors();
renderCompare();

/** CONFETTI */
function fireConfetti() {
  const colors = ["#ff3bd4", "#39f5ff", "#a6ff4d", "#8a5cff", "#ff9f2e"];
  for (let i = 0; i < 56; i++) {
    const conf = document.createElement("div");
    conf.classList.add("confetti");
    conf.style.left = Math.random() * 100 + "vw";
    conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    conf.style.animationDuration = (Math.random() * 2 + 1.8) + "s";
    conf.style.opacity = String(Math.random() * 0.6 + 0.4);
    conf.style.top = "-12px";
    conf.style.zIndex = 999;
    document.body.appendChild(conf);
    setTimeout(() => conf.remove(), 4200);
  }
}

/** Misc */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

/* Make every exercise log-ready */
ensureLogInputs();
</script>

</body>
                                     </html>
